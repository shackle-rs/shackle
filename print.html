<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Shackle Almanac</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="foreword.html">The Shackle Almanac</a></li><li class="chapter-item expanded "><a href="process.html"><strong aria-hidden="true">1.</strong> The Compilation Process</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="compilation/parsing.html"><strong aria-hidden="true">1.1.</strong> Parsing</a></li><li class="chapter-item expanded "><a href="compilation/ast-gen.html"><strong aria-hidden="true">1.2.</strong> MiniZinc AST generation</a></li><li class="chapter-item expanded "><a href="compilation/typecheck.html"><strong aria-hidden="true">1.3.</strong> Type checking</a></li><li class="chapter-item expanded "><a href="compilation/type-specialise.html"><strong aria-hidden="true">1.4.</strong> Type specialisation</a></li><li class="chapter-item expanded "><a href="compilation/transforms.html"><strong aria-hidden="true">1.5.</strong> MiniZinc AST-to-AST transformations</a></li><li class="chapter-item expanded "><a href="compilation/microzinc-gen.html"><strong aria-hidden="true">1.6.</strong> Compilation to MicroZinc</a></li><li class="chapter-item expanded "><a href="compilation/bytecode-gen.html"><strong aria-hidden="true">1.7.</strong> Bytecode generation</a></li><li class="chapter-item expanded "><a href="compilation/interpreter.html"><strong aria-hidden="true">1.8.</strong> Bytecode interpretation</a></li></ol></li><li class="chapter-item expanded "><a href="mzn-syntax.html"><strong aria-hidden="true">2.</strong> MiniZinc Syntax Changes</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Shackle Almanac</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-shackle-almanac"><a class="header" href="#the-shackle-almanac">The Shackle Almanac</a></h1>
<p>This booklet contains the (early) design and documentation of the Shackle constraint modelling framework.
The Shackle project was started as a redesign of the MiniZinc compiler, and the handling the MiniZinc language remains its primary goal.
Early research into a design of such a framework was conducted in Jip J. Dekker's thesis: <a href="https://bridges.monash.edu/articles/thesis/A_Modern_Architecture_for_Constraint_Modelling_Languages/16968229">&quot;A Modern Architecture for Constraint Modelling Languages&quot;</a>
The intention of this document is to be updated throughout the design process as to both keep a history of the design of this framework and make this a start of the internal documentation of the framework.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-compilation-process"><a class="header" href="#the-compilation-process">The Compilation Process</a></h1>
<p>The compilation process for Shackle is divided into several phases.
Each phase is described in more detail in its respective section.
The overall process is divided into two main stages representing development
milestones.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->
<p><svg
   version="1.1"
   id="svg950"
   xml:space="preserve"
   width="528.73334"
   height="565.70667"
   viewBox="0 0 528.73334 565.70667"
   sodipodi:docname="compilation-process.svg"
   inkscape:version="1.1.2 (b8e25be833, 2022-02-05)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><defs
     id="defs954"><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath968"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path966" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath984"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path982" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1000"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path998" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1018"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1016" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1036"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1034" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1048"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1046" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1064"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1062" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1076"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1074" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1096"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1094" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1108"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1106" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1120"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1118" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1132"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1130" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1148"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1146" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1164"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1162" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1180"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1178" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1192"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1190" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1216"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1214" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1228"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1226" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1244"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1242" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1256"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1254" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1278"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1276" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1294"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1292" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1312"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1310" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1328"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1326" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1348"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1346" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1368"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1366" /></clipPath></defs>&lt;sodipodi:namedview
id=&quot;namedview952&quot;
pagecolor=&quot;#ffffff&quot;
bordercolor=&quot;#666666&quot;
borderopacity=&quot;1.0&quot;
inkscape:pageshadow=&quot;2&quot;
inkscape:pageopacity=&quot;0.0&quot;
inkscape:pagecheckerboard=&quot;0&quot;
showgrid=&quot;false&quot;
inkscape:zoom=&quot;1.002451&quot;
inkscape:cx=&quot;442.41565&quot;
inkscape:cy=&quot;319.2176&quot;
inkscape:window-width=&quot;1920&quot;
inkscape:window-height=&quot;1027&quot;
inkscape:window-x=&quot;-8&quot;
inkscape:window-y=&quot;-8&quot;
inkscape:window-maximized=&quot;1&quot;
inkscape:current-layer=&quot;g956&quot; /&gt;<g
     id="g956"
     inkscape:groupmode="layer"
     inkscape:label="Shackle(1)"
     transform="matrix(1.3333333,0,0,-1.3333333,-71.893332,727.07332)"><path
       d="m 188,471.27 h 68.047 v 36.353 H 188 Z"
       style="fill:#fbe5d5;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path958" /><path
       d="m 188,471.27 h 68.047 v 36.353 H 188 Z"
       style="fill:none;stroke:#833c0b;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path960" /><g
       id="g962"><g
         id="g964"
         clip-path="url(#clipPath968)"><text
           transform="matrix(1,0,0,-1,201.65,485.7)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text972"><tspan
             x="0 9.7643003 14.2857 21.043751 23.316475 30.074526 35.3535"
             y="0"
             sodipodi:role="line"
             id="tspan970">mzn CST</tspan></text></g></g><path
       d="m 338.05,470.69 h 69.682 v 36.943 H 338.05 Z"
       style="fill:#fbe5d5;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path974" /><path
       d="m 338.05,470.69 h 69.682 v 36.943 H 338.05 Z"
       style="fill:none;stroke:#833c0b;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path976" /><g
       id="g978"><g
         id="g980"
         clip-path="url(#clipPath984)"><text
           transform="matrix(1,0,0,-1,352.4,485.4)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text988"><tspan
             x="0 9.7643003 14.26165 20.995649 23.244326 29.990351 35.978802"
             y="0"
             sodipodi:role="line"
             id="tspan986">mzn AST</tspan></text></g></g><path
       d="m 76.972,489.15 c 0,10.2 8.237,18.47 18.399,18.47 10.159,0 18.399,-8.27 18.399,-18.47 0,-10.21 -8.24,-18.48 -18.399,-18.48 -10.162,0 -18.399,8.27 -18.399,18.48 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path990" /><path
       d="m 76.972,489.15 c 0,10.2 8.237,18.47 18.399,18.47 10.159,0 18.399,-8.27 18.399,-18.47 0,-10.21 -8.24,-18.48 -18.399,-18.48 -10.162,0 -18.399,8.27 -18.399,18.48 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path992" /><g
       id="g994"><g
         id="g996"
         clip-path="url(#clipPath1000)"><text
           transform="matrix(1,0,0,-1,85.15,485.4)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1004"><tspan
             x="0 9.7402496 14.2376"
             y="0"
             sodipodi:role="line"
             id="tspan1002">mzn</tspan></text></g></g><path
       d="m 113.77,489.15 h 13.5 v 0.3 h 54.57"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path1006" /><path
       d="m 180.96,492.97 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1008" /><g
       id="g1012"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1014"
         clip-path="url(#clipPath1018)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,131.77,496.4)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1022"><tspan
             x="0 6.0004749 11.988925 16.474251 20.9716 23.220276 29.954275"
             y="0"
             sodipodi:role="line"
             id="tspan1020">Parsing</tspan></text></g></g><path
       d="m 256.04,489.45 h 13.5 v -0.29 h 62.35"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path1024" /><path
       d="m 331.01,492.68 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1026" /><g
       id="g1030"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1032"
         clip-path="url(#clipPath1036)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,281.98,509.77)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1040"><tspan
             x="0 5.2549248 8.2371254 17.977375 23.97785 26.960051"
             y="0"
             sodipodi:role="line"
             id="tspan1038">Simple</tspan></text></g></g><g
       id="g1042"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1044"
         clip-path="url(#clipPath1048)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,271.63,495.35)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1052"><tspan
             x="0 6 11.976 17.243999 23.243999 29.232 34.476002 38.964001 41.208 47.952"
             y="0"
             sodipodi:role="line"
             id="tspan1050">desugaring</tspan></text></g></g><path
       d="m 125.34,395.46 h 62.72 l 6.97,36.95 h -62.72 z"
       style="fill:#fff2cc;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1054" /><path
       d="m 125.34,395.46 h 62.72 l 6.97,36.95 h -62.72 z"
       style="fill:none;stroke:#7f6000;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1056" /><g
       id="g1058"><g
         id="g1060"
         clip-path="url(#clipPath1064)"><text
           transform="matrix(1,0,0,-1,148.55,417.3)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1068"><tspan
             x="0 5.9884501 11.243375 17.243851 23.2323"
             y="0"
             sodipodi:role="line"
             id="tspan1066">Type </tspan></text></g></g><g
       id="g1070"><g
         id="g1072"
         clip-path="url(#clipPath1076)"><text
           transform="matrix(1,0,0,-1,139.02,402.88)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1080"><tspan
             x="0 5.2428999 11.243375 17.231825 22.48675 27.741674 30.723875 36.72435"
             y="0"
             sodipodi:role="line"
             id="tspan1078">checking</tspan></text></g></g><path
       d="m 407.73,489.16 h 13.5 V 445.91 H 111.84 v -31.97 h 10.83"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1082" /><path
       d="m 121.79,417.46 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1084" /><path
       d="m 102.11,327.78 h 104.54 l 11.61,36.95 H 113.72 Z"
       style="fill:#deebf6;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1086" /><path
       d="m 102.11,327.78 h 104.54 l 11.61,36.95 H 113.72 Z"
       style="fill:none;stroke:#3955a3;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1088" /><g
       id="g1090"><g
         id="g1092"
         clip-path="url(#clipPath1096)"><text
           transform="matrix(1,0,0,-1,140.18,349.52)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1100"><tspan
             x="0 6.756 12.744"
             y="0"
             sodipodi:role="line"
             id="tspan1098">AST</tspan></text></g></g><g
       id="g1102"><g
         id="g1104"
         clip-path="url(#clipPath1108)"><text
           transform="matrix(1,0,0,-1,158.5,349.52)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1112"><tspan
             x="0"
             y="0"
             id="tspan1110">-</tspan></text></g></g><g
       id="g1114"><g
         id="g1116"
         clip-path="url(#clipPath1120)"><text
           transform="matrix(1,0,0,-1,162.17,349.52)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1124"><tspan
             x="0 6.756 12.744 18"
             y="0"
             sodipodi:role="line"
             id="tspan1122">AST </tspan></text></g></g><g
       id="g1126"><g
         id="g1128"
         clip-path="url(#clipPath1132)"><text
           transform="matrix(1,0,0,-1,121.02,335.1)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1136"><tspan
             x="0 3.744 8.2320004 14.22 20.219999 24.719999 28.452 35.183998 38.928001 48.66 54.647999 58.391998 61.380001 67.379997 73.379997"
             y="0"
             sodipodi:role="line"
             id="tspan1134">transformations</tspan></text></g></g><g
       id="g1138"
       style="fill:none;fill-opacity:1;stroke:currentColor;stroke-opacity:1"><path
         d="m 54.295,305.79 h 395.8 v 239.14 h -395.8 z"
         style="fill:none;stroke:currentColor;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:6, 3;stroke-dashoffset:0;stroke-opacity:1;fill-opacity:1"
         id="path1140" /></g><g
       id="g1142"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1144"
         clip-path="url(#clipPath1148)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,58.35,530.03)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1152"><tspan
             x="0 5.256 9.7440004 14.988 20.976 26.952 29.232"
             y="0"
             sodipodi:role="line"
             id="tspan1150">Stage 1</tspan></text></g></g><g
       id="g1154"
       style="fill:none;fill-opacity:1;stroke:currentColor;stroke-opacity:1"><path
         d="m 54.302,121.4 h 395.44 V 275.05 H 54.302 Z"
         style="fill:none;stroke:currentColor;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:6, 3;stroke-dashoffset:0;stroke-opacity:1;fill-opacity:1"
         id="path1156" /></g><g
       id="g1158"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1160"
         clip-path="url(#clipPath1164)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,58.35,259.83)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1168"><tspan
             x="0 5.278975 9.7883501 15.067325 21.079824 27.092325 29.341"
             y="0"
             sodipodi:role="line"
             id="tspan1166">Stage 2</tspan></text></g></g><path
       d="m 293.78,395.47 h 85.85 l 9.54,36.94 h -85.85 z"
       style="fill:#fff2cc;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1170" /><path
       d="m 293.78,395.47 h 85.85 l 9.54,36.94 h -85.85 z"
       style="fill:none;stroke:#7f6000;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1172" /><g
       id="g1174"><g
         id="g1176"
         clip-path="url(#clipPath1180)"><text
           transform="matrix(1,0,0,-1,330.02,417.3)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1184"><tspan
             x="0 5.9884501 11.243375 17.243851 23.2323"
             y="0"
             sodipodi:role="line"
             id="tspan1182">Type </tspan></text></g></g><g
       id="g1186"><g
         id="g1188"
         clip-path="url(#clipPath1192)"><text
           transform="matrix(1,0,0,-1,308.83,402.88)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1196"><tspan
             x="0 4.5 11.244 17.219999 21.743999 24.732 30.719999 32.964001 35.952 40.452 46.439999 50.183998 53.172001 59.172001"
             y="0"
             sodipodi:role="line"
             id="tspan1194">specialisation</tspan></text></g></g><path
       d="m 191.54,413.94 h 16.99 v 0 h 83.86"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1198" /><path
       d="m 291.51,417.46 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1200" /><path
       d="m 336.71,395.47 v -13.5 H 88.607 v -35.71 h 13.143"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1202" /><path
       d="m 100.87,349.78 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1204" /><path
       d="m 396.31,346.25 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1206" /><path
       d="m 396.31,346.25 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1208" /><g
       id="g1210"><g
         id="g1212"
         clip-path="url(#clipPath1216)"><text
           transform="matrix(1,0,0,-1,406.27,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1220"><tspan
             x="0"
             y="0"
             id="tspan1218">μ</tspan></text></g></g><g
       id="g1222"><g
         id="g1224"
         clip-path="url(#clipPath1228)"><text
           transform="matrix(1,0,0,-1,412.88,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1232"><tspan
             x="0 4.5248752"
             y="0"
             sodipodi:role="line"
             id="tspan1230">zn</tspan></text></g></g><path
       d="m 306.63,327.78 h 69.682 v 36.943 H 306.63 Z"
       style="fill:#fbe5d5;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1234" /><path
       d="m 306.63,327.78 h 69.682 v 36.943 H 306.63 Z"
       style="fill:none;stroke:#833c0b;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1236" /><g
       id="g1238"><g
         id="g1240"
         clip-path="url(#clipPath1244)"><text
           transform="matrix(1,0,0,-1,322.45,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1248"><tspan
             x="0"
             y="0"
             id="tspan1246">μ</tspan></text></g></g><g
       id="g1250"><g
         id="g1252"
         clip-path="url(#clipPath1256)"><text
           transform="matrix(1,0,0,-1,329.05,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1260"><tspan
             x="0 4.5214 11.27945 13.528125 21.043751 26.322725"
             y="0"
             sodipodi:role="line"
             id="tspan1258">zn AST</tspan></text></g></g><path
       d="m 376.32,346.26 h 6.75 v -0.01 h 7.08"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1262" /><path
       d="m 389.27,349.77 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1264" /><path
       d="m 212.46,346.26 h 88.01"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1266" /><path
       d="m 299.59,349.78 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1268" /><g
       id="g1272"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1274"
         clip-path="url(#clipPath1278)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,230.83,351.58)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1282"><tspan
             x="0 6.744 12.744 22.511999 28.511999 31.5 34.487999 39.731998 44.220001 46.464001 53.195999"
             y="0"
             sodipodi:role="line"
             id="tspan1280">Compilation</tspan></text></g></g><path
       d="m 76.972,216.57 c 0,10.2 15.598,18.47 34.838,18.47 19.24,0 34.84,-8.27 34.84,-18.47 0,-10.2 -15.6,-18.47 -34.84,-18.47 -19.24,0 -34.838,8.27 -34.838,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1284" /><path
       d="m 76.972,216.57 c 0,10.2 15.598,18.47 34.838,18.47 19.24,0 34.84,-8.27 34.84,-18.47 0,-10.2 -15.6,-18.47 -34.84,-18.47 -19.24,0 -34.838,8.27 -34.838,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1286" /><g
       id="g1288"><g
         id="g1290"
         clip-path="url(#clipPath1294)"><text
           transform="matrix(1,0,0,-1,89.2,212.48)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1298"><tspan
             x="0 6.0004749 11.988925 15.740725 21.729176 26.9841 32.984573 39.718575"
             y="0"
             sodipodi:role="line"
             id="tspan1296">bytecode</tspan></text></g></g><path
       d="M 414.71,327.78 V 247.7 H 63.472 v -31.13 h 7.34"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1300" /><path
       d="m 69.932,220.09 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1302" /><g
       id="g1306"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1308"
         clip-path="url(#clipPath1312)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,215.58,257.63)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1316"><tspan
             x="0 6.7340002 12.734475 18.734949 24.7234 27.717625 32.972549 38.960999 45.707024 51.695477 55.459301 61.44775 65.199547 68.181747 74.915749"
             y="0"
             sodipodi:role="line"
             id="tspan1314">Code generation</tspan></text></g></g><path
       d="m 193.95,198.08 h 104.54 l 11.62,36.95 H 205.57 Z"
       style="fill:#deebf6;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1318" /><path
       d="m 193.95,198.08 h 104.54 l 11.62,36.95 H 205.57 Z"
       style="fill:none;stroke:#3955a3;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1320" /><g
       id="g1322"><g
         id="g1324"
         clip-path="url(#clipPath1328)"><text
           transform="matrix(1,0,0,-1,217.68,212.45)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1332"><tspan
             x="0 3.0239999 9 13.488 19.464001 23.232 29.976 33.720001 39.695999 44.208 49.452 53.939999 56.183998 62.916"
             y="0"
             sodipodi:role="line"
             id="tspan1330">Interpretation</tspan></text></g></g><path
       d="m 146.65,216.57 h 13.5 v -0.02 h 33.45"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1334" /><path
       d="m 192.72,220.07 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1336" /><path
       d="m 396.32,216.56 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1338" /><path
       d="m 396.32,216.56 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1340" /><g
       id="g1342"><g
         id="g1344"
         clip-path="url(#clipPath1348)"><text
           transform="matrix(1,0,0,-1,407.75,212.48)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1352"><tspan
             x="0 3.7638249 8.2852249"
             y="0"
             sodipodi:role="line"
             id="tspan1350">fzn</tspan></text></g></g><path
       d="m 304.3,216.55 h 19.31 v 0.01 h 66.55"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1354" /><path
       d="m 389.28,220.08 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1356" /><path
       d="m 88.535,155.17 c 0,10.21 8.238,18.48 18.395,18.48 10.17,0 18.4,-8.27 18.4,-18.48 0,-10.2 -8.23,-18.47 -18.4,-18.47 -10.157,0 -18.395,8.27 -18.395,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1358" /><path
       d="m 88.535,155.17 c 0,10.21 8.238,18.48 18.395,18.48 10.17,0 18.4,-8.27 18.4,-18.48 0,-10.2 -8.23,-18.47 -18.4,-18.47 -10.157,0 -18.395,8.27 -18.395,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1360" /><g
       id="g1362"><g
         id="g1364"
         clip-path="url(#clipPath1368)"><text
           transform="matrix(1,0,0,-1,98.35,151)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1372"><tspan
             x="0 6.0004749 11.243375"
             y="0"
             sodipodi:role="line"
             id="tspan1370">dzn</tspan></text></g></g><path
       d="m 125.33,155.17 h 120.89 v 36.75"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1374" /><path
       d="m 242.7,191.04 3.52,7.04 3.52,-7.04 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1376" /></g></svg></p>
<h2 id="compilation-phases"><a class="header" href="#compilation-phases">Compilation phases</a></h2>
<ol>
<li><a href="./compilation/parsing.html">Parsing</a><br />
<code>tree-sitter</code> is used to generate a CST from a MiniZinc model.</li>
<li><a href="./compilation/ast-gen.html">MiniZinc AST generation</a><br />
A simple desugaring phase which generates an AST linked to CST.</li>
<li><a href="./compilation/typecheck.html">Type checking</a><br />
Bottom up typechecking, with an additional unification step for dealing with
any remaining unresolved types due to <code>_</code> or <code>&lt;&gt;</code>.</li>
<li><a href="./compilation/type-specialise.html">Type specialisation</a><br />
Monomorphisation of polymorphic functions.</li>
<li><a href="./compilation/transforms.html">MiniZinc AST-to-AST transformations</a><br />
Main desugaring transformation phase.</li>
<li><a href="./compilation/microzinc-gen.html">Compilation to MicroZinc</a><br />
The MiniZinc AST is transformed into MicroZinc AST, which involves
removal of function overloading, rewriting operators into calls,
replacement of variable conditions with an appropriate decomposition, and
removing partiality.</li>
<li><a href="./compilation/bytecode-gen.html">Bytecode generation</a><br />
Code generation of a program which will be interpreted to generate the final
FlatZinc.</li>
<li><a href="./compilation/interpreter.html">Bytecode interpretation</a><br />
The bytecode along with the data is interpreted to produce NanoZinc and later
FlatZinc or any other format for solver backends.</li>
</ol>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<ul>
<li>Compilation to MicroZinc happens without data</li>
<li>Models are compiled with only declarations of standard library functions.
Calls are resolved later by the interpreter, allowing the library to be
swapped out without recompilation.</li>
<li>The standard library, and solver redefinition libraries can be distributed
pre-compiled into MicroZinc.</li>
<li>The new compiler will use <a href="https://github.com/salsa-rs/salsa">Salsa</a> so that
computed results can be memoised and only updated as needed.</li>
</ul>
<h2 id="project-notes"><a class="header" href="#project-notes">Project notes</a></h2>
<ul>
<li>Steps 1-6 will be the starting point for the compiler. The current MiniZinc
interpreter will be extended to handle MicroZinc (e.g. support for tuples)
to allow for testing of the new frontend.</li>
<li>Steps 7-8 require more research/discussion.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parsing"><a class="header" href="#parsing">Parsing</a></h1>
<p><code>tree-sitter</code> is used to generate a concrete syntax tree from a MiniZinc model.</p>
<p>Since this concrete syntax tree is too low level to perform most useful
compilation steps, an abstract syntax tree will be constructed (with the AST
nodes linked to the related CST nodes) during <a href="compilation/ast-gen.html">AST generation</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minizinc-ast-generation"><a class="header" href="#minizinc-ast-generation">MiniZinc AST generation</a></h1>
<p>After parsing, a MiniZinc AST will be generated from the CST.</p>
<ul>
<li>Whitespace and comments are ignored in the AST</li>
<li>Generators in calls and comprehensions can generate the same AST nodes</li>
</ul>
<p>The AST nodes will need to maintain a link to the CST nodes they originated from
(akin to <code>Location</code>s in the old compiler).</p>
<h2 id="notes-1"><a class="header" href="#notes-1">Notes</a></h2>
<ul>
<li>Using Salsa means that we do not need to include storage for results in the
AST. Instead, these will be stored in the Salsa database and accessed using
queries</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-checking"><a class="header" href="#type-checking">Type checking</a></h1>
<p>The types for each expression will be determined in a bottom-up fashion. That
is, the types of child nodes are used to determine the type of parent nodes (and
check for correctness). This stage also matches calls with their declarations.</p>
<pre><code class="language-mzn">constraint let {
    var 1..10: x;
} in x == 5;
</code></pre>
<h2 id="unification"><a class="header" href="#unification">Unification</a></h2>
<p>For literals which have a bottom type (e.g. <code>&lt;&gt;</code> and <code>_</code>), a special unification
step needs to be performed. Note that this unification does not perform
inference across items. Instead, one of the types to be unified must be a
concrete type.</p>
<pre><code class="language-mzn">array [int] of var opt int: x = [&lt;&gt;, _];
</code></pre>
<p>Bottom up typing will be unable to determine a concrete type for the <code>[&lt;&gt;, _]</code>
literal (although it is known to be <code>var opt</code>). Instead, the left-hand side type should be pushed into it.</p>
<pre><code class="language-mzn">test foo(array [int] of var opt int: x) = true;
constraint foo([_, _]);
</code></pre>
<p>Bottom up typing will be unable to determine a type for the <code>[_, _]</code> literal.
The type from the parameter <code>x</code> in the declaration of <code>foo</code> should be pushed
into it (since there is only one declaration of <code>foo</code>, this is unambiguous).</p>
<h3 id="ambiguous-types"><a class="header" href="#ambiguous-types">Ambiguous types</a></h3>
<p>When there is not a single unambiguous type for a value, this is considered a
type error.</p>
<pre><code class="language-mzn">test foo(array [int] of var opt $T: x) = true;
constraint foo([_]);
</code></pre>
<p>The type of <code>[_]</code> could be <code>array [int] of var opt int</code> or
<code>array [int] of var opt float</code>, or many others. Therefore, this would be a
type error. To get around this, a variable declaration for <code>[_]</code> could be
used. Otherwise, new syntax for annotating a literal with its type is required.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-specialisation"><a class="header" href="#type-specialisation">Type specialisation</a></h1>
<p>Calls to polymorphic functions are monomorphised into versions which use
concrete types. Name mangling is used to produce the new declarations (and
allow recovery of the original name).</p>
<h2 id="notes-2"><a class="header" href="#notes-2">Notes</a></h2>
<p>Since we intend to pre-compile the standard library, we will have to
monomorphise any polymorphic functions based on what the possible types for
the call arguments are.</p>
<p>Alternatively we could leave polymorphic functions un-compiled and instead
compile them on the fly.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minizinc-ast-to-ast-transformations"><a class="header" href="#minizinc-ast-to-ast-transformations">MiniZinc AST-to-AST transformations</a></h1>
<p>In this phase, more complex desugaring operations are performed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compilation-to-microzinc"><a class="header" href="#compilation-to-microzinc">Compilation to MicroZinc</a></h1>
<p>Compilation of the MiniZinc AST to MicroZinc will involve transformation to
a new AST for MicroZinc.</p>
<h2 id="replacing-operators-by-function-calls"><a class="header" href="#replacing-operators-by-function-calls">Replacing operators by function calls</a></h2>
<p>Operators need to be replaced by calls.</p>
<h2 id="decomposition-of-variable-conditionals"><a class="header" href="#decomposition-of-variable-conditionals">Decomposition of variable conditionals</a></h2>
<p><code>if-then-else</code> expressions with a variable condition need to be rewritten into
function calls.</p>
<h2 id="lifting-partiality"><a class="header" href="#lifting-partiality">Lifting partiality</a></h2>
<p>Partial functions need to transformed into total functions.</p>
<h2 id="subtype-based-overloading"><a class="header" href="#subtype-based-overloading">Subtype based overloading</a></h2>
<p>As functions arguments also accept their subtypes, these should be transformed
to dispatch to their specialised counterparts.</p>
<h2 id="pass-values-from-outer-scopes-of-functions-through-parameters"><a class="header" href="#pass-values-from-outer-scopes-of-functions-through-parameters">Pass values from outer scopes of functions through parameters</a></h2>
<p>Functions which refer to variables outside the scope of the function need to be
transformed such that these variables are passed as arguments to the function.</p>
<h2 id="generation-of-the-main-entrypoint"><a class="header" href="#generation-of-the-main-entrypoint">Generation of the main entrypoint</a></h2>
<p>MicroZinc uses a top-level function <code>main</code> as its entrypoint for the interpreter.</p>
<p>The top-level decision variable and constraints are added as a <code>let</code> expression
in this function, taking the model parameters as arguments.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bytecode-generation"><a class="header" href="#bytecode-generation">Bytecode generation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bytecode-interpretation"><a class="header" href="#bytecode-interpretation">Bytecode interpretation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minizinc-syntax-changes"><a class="header" href="#minizinc-syntax-changes">MiniZinc Syntax Changes</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="theme/mzn-highlight.js"></script>
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
