<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Shackle Almanac</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script
          id="MathJax-script"
          async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
        ></script>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="foreword.html">The Shackle Almanac</a></li><li class="chapter-item expanded "><a href="process.html"><strong aria-hidden="true">1.</strong> The Compilation Process</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="compilation/parsing.html"><strong aria-hidden="true">1.1.</strong> Parsing</a></li><li class="chapter-item expanded "><a href="compilation/ast-gen.html"><strong aria-hidden="true">1.2.</strong> MiniZinc AST generation</a></li><li class="chapter-item expanded "><a href="compilation/typecheck.html"><strong aria-hidden="true">1.3.</strong> Type checking</a></li><li class="chapter-item expanded "><a href="compilation/type-specialise.html"><strong aria-hidden="true">1.4.</strong> Type specialisation</a></li><li class="chapter-item expanded "><a href="compilation/transforms.html"><strong aria-hidden="true">1.5.</strong> MiniZinc AST-to-AST transformations</a></li><li class="chapter-item expanded "><a href="compilation/microzinc-gen.html"><strong aria-hidden="true">1.6.</strong> Compilation to MicroZinc</a></li><li class="chapter-item expanded "><a href="compilation/bytecode-gen.html"><strong aria-hidden="true">1.7.</strong> Bytecode generation</a></li><li class="chapter-item expanded "><a href="compilation/interpreter.html"><strong aria-hidden="true">1.8.</strong> Bytecode interpretation</a></li></ol></li><li class="chapter-item expanded "><a href="microzinc.html"><strong aria-hidden="true">2.</strong> MicroZinc specification</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="microzinc/types.html"><strong aria-hidden="true">2.1.</strong> Typing Rules</a></li><li class="chapter-item expanded "><a href="microzinc/semantics.html"><strong aria-hidden="true">2.2.</strong> Operational Semantics</a></li></ol></li><li class="chapter-item expanded "><a href="interpreter.html"><strong aria-hidden="true">3.</strong> The MicroZinc Interpreter</a></li><li class="chapter-item expanded "><a href="mzn-syntax.html"><strong aria-hidden="true">4.</strong> MiniZinc Syntax Changes</a></li><li class="chapter-item expanded "><a href="error-handling.html"><strong aria-hidden="true">5.</strong> Error handling</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Shackle Almanac</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-shackle-almanac"><a class="header" href="#the-shackle-almanac">The Shackle Almanac</a></h1>
<p>This booklet contains the (early) design and documentation of the Shackle constraint modelling framework.
The Shackle project was started as a redesign of the MiniZinc compiler, and the handling the MiniZinc language remains its primary goal.
Early research into a design of such a framework was conducted in Jip J. Dekker's thesis: <a href="https://bridges.monash.edu/articles/thesis/A_Modern_Architecture_for_Constraint_Modelling_Languages/16968229">&quot;A Modern Architecture for Constraint Modelling Languages&quot;</a>
The intention of this document is to be updated throughout the design process as to both keep a history of the design of this framework and make this a start of the internal documentation of the framework.</p>
<h2 id="acknowledgements"><a class="header" href="#acknowledgements">Acknowledgements</a></h2>
<p>This research was partially funded by the Australian Government through the Australian Research Council Industrial Transformation Training Centre in Optimisation Technologies, Integrated Methodologies, and Applications (<a href="https://optima.org.au">OPTIMA</a>), Project ID IC200100009.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-compilation-process"><a class="header" href="#the-compilation-process">The Compilation Process</a></h1>
<p>The compilation process for Shackle is divided into several phases.
Each phase is described in more detail in its respective section.
The overall process is divided into two main stages representing development
milestones.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->
<p><svg
   version="1.1"
   id="svg950"
   xml:space="preserve"
   width="528.73334"
   height="565.70667"
   viewBox="0 0 528.73334 565.70667"
   sodipodi:docname="compilation-process.svg"
   inkscape:version="1.1.2 (b8e25be833, 2022-02-05)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><defs
     id="defs954"><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath968"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path966" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath984"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path982" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1000"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path998" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1018"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1016" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1036"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1034" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1048"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1046" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1064"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1062" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1076"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1074" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1096"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1094" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1108"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1106" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1120"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1118" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1132"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1130" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1148"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1146" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1164"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1162" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1180"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1178" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1192"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1190" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1216"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1214" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1228"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1226" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1244"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1242" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1256"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1254" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1278"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1276" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1294"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1292" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1312"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1310" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1328"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1326" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1348"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1346" /></clipPath><clipPath
       clipPathUnits="userSpaceOnUse"
       id="clipPath1368"><path
         d="M 1.1802e-5,0 H 792.00001 V 612 H 1.1802e-5 Z"
         clip-rule="evenodd"
         id="path1366" /></clipPath></defs>&lt;sodipodi:namedview
id=&quot;namedview952&quot;
pagecolor=&quot;#ffffff&quot;
bordercolor=&quot;#666666&quot;
borderopacity=&quot;1.0&quot;
inkscape:pageshadow=&quot;2&quot;
inkscape:pageopacity=&quot;0.0&quot;
inkscape:pagecheckerboard=&quot;0&quot;
showgrid=&quot;false&quot;
inkscape:zoom=&quot;1.002451&quot;
inkscape:cx=&quot;442.41565&quot;
inkscape:cy=&quot;319.2176&quot;
inkscape:window-width=&quot;1920&quot;
inkscape:window-height=&quot;1027&quot;
inkscape:window-x=&quot;-8&quot;
inkscape:window-y=&quot;-8&quot;
inkscape:window-maximized=&quot;1&quot;
inkscape:current-layer=&quot;g956&quot; /&gt;<g
     id="g956"
     inkscape:groupmode="layer"
     inkscape:label="Shackle(1)"
     transform="matrix(1.3333333,0,0,-1.3333333,-71.893332,727.07332)"><path
       d="m 188,471.27 h 68.047 v 36.353 H 188 Z"
       style="fill:#fbe5d5;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path958" /><path
       d="m 188,471.27 h 68.047 v 36.353 H 188 Z"
       style="fill:none;stroke:#833c0b;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path960" /><g
       id="g962"><g
         id="g964"
         clip-path="url(#clipPath968)"><text
           transform="matrix(1,0,0,-1,201.65,485.7)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text972"><tspan
             x="0 9.7643003 14.2857 21.043751 23.316475 30.074526 35.3535"
             y="0"
             sodipodi:role="line"
             id="tspan970">mzn CST</tspan></text></g></g><path
       d="m 338.05,470.69 h 69.682 v 36.943 H 338.05 Z"
       style="fill:#fbe5d5;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path974" /><path
       d="m 338.05,470.69 h 69.682 v 36.943 H 338.05 Z"
       style="fill:none;stroke:#833c0b;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path976" /><g
       id="g978"><g
         id="g980"
         clip-path="url(#clipPath984)"><text
           transform="matrix(1,0,0,-1,352.4,485.4)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text988"><tspan
             x="0 9.7643003 14.26165 20.995649 23.244326 29.990351 35.978802"
             y="0"
             sodipodi:role="line"
             id="tspan986">mzn AST</tspan></text></g></g><path
       d="m 76.972,489.15 c 0,10.2 8.237,18.47 18.399,18.47 10.159,0 18.399,-8.27 18.399,-18.47 0,-10.21 -8.24,-18.48 -18.399,-18.48 -10.162,0 -18.399,8.27 -18.399,18.48 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path990" /><path
       d="m 76.972,489.15 c 0,10.2 8.237,18.47 18.399,18.47 10.159,0 18.399,-8.27 18.399,-18.47 0,-10.21 -8.24,-18.48 -18.399,-18.48 -10.162,0 -18.399,8.27 -18.399,18.48 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path992" /><g
       id="g994"><g
         id="g996"
         clip-path="url(#clipPath1000)"><text
           transform="matrix(1,0,0,-1,85.15,485.4)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1004"><tspan
             x="0 9.7402496 14.2376"
             y="0"
             sodipodi:role="line"
             id="tspan1002">mzn</tspan></text></g></g><path
       d="m 113.77,489.15 h 13.5 v 0.3 h 54.57"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path1006" /><path
       d="m 180.96,492.97 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1008" /><g
       id="g1012"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1014"
         clip-path="url(#clipPath1018)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,131.77,496.4)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1022"><tspan
             x="0 6.0004749 11.988925 16.474251 20.9716 23.220276 29.954275"
             y="0"
             sodipodi:role="line"
             id="tspan1020">Parsing</tspan></text></g></g><path
       d="m 256.04,489.45 h 13.5 v -0.29 h 62.35"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
       id="path1024" /><path
       d="m 331.01,492.68 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1026" /><g
       id="g1030"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1032"
         clip-path="url(#clipPath1036)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,281.98,509.77)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1040"><tspan
             x="0 5.2549248 8.2371254 17.977375 23.97785 26.960051"
             y="0"
             sodipodi:role="line"
             id="tspan1038">Simple</tspan></text></g></g><g
       id="g1042"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1044"
         clip-path="url(#clipPath1048)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,271.63,495.35)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1052"><tspan
             x="0 6 11.976 17.243999 23.243999 29.232 34.476002 38.964001 41.208 47.952"
             y="0"
             sodipodi:role="line"
             id="tspan1050">desugaring</tspan></text></g></g><path
       d="m 125.34,395.46 h 62.72 l 6.97,36.95 h -62.72 z"
       style="fill:#fff2cc;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1054" /><path
       d="m 125.34,395.46 h 62.72 l 6.97,36.95 h -62.72 z"
       style="fill:none;stroke:#7f6000;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1056" /><g
       id="g1058"><g
         id="g1060"
         clip-path="url(#clipPath1064)"><text
           transform="matrix(1,0,0,-1,148.55,417.3)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1068"><tspan
             x="0 5.9884501 11.243375 17.243851 23.2323"
             y="0"
             sodipodi:role="line"
             id="tspan1066">Type </tspan></text></g></g><g
       id="g1070"><g
         id="g1072"
         clip-path="url(#clipPath1076)"><text
           transform="matrix(1,0,0,-1,139.02,402.88)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1080"><tspan
             x="0 5.2428999 11.243375 17.231825 22.48675 27.741674 30.723875 36.72435"
             y="0"
             sodipodi:role="line"
             id="tspan1078">checking</tspan></text></g></g><path
       d="m 407.73,489.16 h 13.5 V 445.91 H 111.84 v -31.97 h 10.83"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1082" /><path
       d="m 121.79,417.46 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1084" /><path
       d="m 102.11,327.78 h 104.54 l 11.61,36.95 H 113.72 Z"
       style="fill:#deebf6;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1086" /><path
       d="m 102.11,327.78 h 104.54 l 11.61,36.95 H 113.72 Z"
       style="fill:none;stroke:#3955a3;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1088" /><g
       id="g1090"><g
         id="g1092"
         clip-path="url(#clipPath1096)"><text
           transform="matrix(1,0,0,-1,140.18,349.52)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1100"><tspan
             x="0 6.756 12.744"
             y="0"
             sodipodi:role="line"
             id="tspan1098">AST</tspan></text></g></g><g
       id="g1102"><g
         id="g1104"
         clip-path="url(#clipPath1108)"><text
           transform="matrix(1,0,0,-1,158.5,349.52)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1112"><tspan
             x="0"
             y="0"
             id="tspan1110">-</tspan></text></g></g><g
       id="g1114"><g
         id="g1116"
         clip-path="url(#clipPath1120)"><text
           transform="matrix(1,0,0,-1,162.17,349.52)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1124"><tspan
             x="0 6.756 12.744 18"
             y="0"
             sodipodi:role="line"
             id="tspan1122">AST </tspan></text></g></g><g
       id="g1126"><g
         id="g1128"
         clip-path="url(#clipPath1132)"><text
           transform="matrix(1,0,0,-1,121.02,335.1)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1136"><tspan
             x="0 3.744 8.2320004 14.22 20.219999 24.719999 28.452 35.183998 38.928001 48.66 54.647999 58.391998 61.380001 67.379997 73.379997"
             y="0"
             sodipodi:role="line"
             id="tspan1134">transformations</tspan></text></g></g><g
       id="g1138"
       style="fill:none;fill-opacity:1;stroke:currentColor;stroke-opacity:1"><path
         d="m 54.295,305.79 h 395.8 v 239.14 h -395.8 z"
         style="fill:none;stroke:currentColor;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:6, 3;stroke-dashoffset:0;stroke-opacity:1;fill-opacity:1"
         id="path1140" /></g><g
       id="g1142"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1144"
         clip-path="url(#clipPath1148)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,58.35,530.03)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1152"><tspan
             x="0 5.256 9.7440004 14.988 20.976 26.952 29.232"
             y="0"
             sodipodi:role="line"
             id="tspan1150">Stage 1</tspan></text></g></g><g
       id="g1154"
       style="fill:none;fill-opacity:1;stroke:currentColor;stroke-opacity:1"><path
         d="m 54.302,121.4 h 395.44 V 275.05 H 54.302 Z"
         style="fill:none;stroke:currentColor;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:6, 3;stroke-dashoffset:0;stroke-opacity:1;fill-opacity:1"
         id="path1156" /></g><g
       id="g1158"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1160"
         clip-path="url(#clipPath1164)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,58.35,259.83)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1168"><tspan
             x="0 5.278975 9.7883501 15.067325 21.079824 27.092325 29.341"
             y="0"
             sodipodi:role="line"
             id="tspan1166">Stage 2</tspan></text></g></g><path
       d="m 293.78,395.47 h 85.85 l 9.54,36.94 h -85.85 z"
       style="fill:#fff2cc;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1170" /><path
       d="m 293.78,395.47 h 85.85 l 9.54,36.94 h -85.85 z"
       style="fill:none;stroke:#7f6000;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1172" /><g
       id="g1174"><g
         id="g1176"
         clip-path="url(#clipPath1180)"><text
           transform="matrix(1,0,0,-1,330.02,417.3)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1184"><tspan
             x="0 5.9884501 11.243375 17.243851 23.2323"
             y="0"
             sodipodi:role="line"
             id="tspan1182">Type </tspan></text></g></g><g
       id="g1186"><g
         id="g1188"
         clip-path="url(#clipPath1192)"><text
           transform="matrix(1,0,0,-1,308.83,402.88)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#7f6000;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1196"><tspan
             x="0 4.5 11.244 17.219999 21.743999 24.732 30.719999 32.964001 35.952 40.452 46.439999 50.183998 53.172001 59.172001"
             y="0"
             sodipodi:role="line"
             id="tspan1194">specialisation</tspan></text></g></g><path
       d="m 191.54,413.94 h 16.99 v 0 h 83.86"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1198" /><path
       d="m 291.51,417.46 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1200" /><path
       d="m 336.71,395.47 v -13.5 H 88.607 v -35.71 h 13.143"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1202" /><path
       d="m 100.87,349.78 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1204" /><path
       d="m 396.31,346.25 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1206" /><path
       d="m 396.31,346.25 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1208" /><g
       id="g1210"><g
         id="g1212"
         clip-path="url(#clipPath1216)"><text
           transform="matrix(1,0,0,-1,406.27,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1220"><tspan
             x="0"
             y="0"
             id="tspan1218">μ</tspan></text></g></g><g
       id="g1222"><g
         id="g1224"
         clip-path="url(#clipPath1228)"><text
           transform="matrix(1,0,0,-1,412.88,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1232"><tspan
             x="0 4.5248752"
             y="0"
             sodipodi:role="line"
             id="tspan1230">zn</tspan></text></g></g><path
       d="m 306.63,327.78 h 69.682 v 36.943 H 306.63 Z"
       style="fill:#fbe5d5;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1234" /><path
       d="m 306.63,327.78 h 69.682 v 36.943 H 306.63 Z"
       style="fill:none;stroke:#833c0b;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1236" /><g
       id="g1238"><g
         id="g1240"
         clip-path="url(#clipPath1244)"><text
           transform="matrix(1,0,0,-1,322.45,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1248"><tspan
             x="0"
             y="0"
             id="tspan1246">μ</tspan></text></g></g><g
       id="g1250"><g
         id="g1252"
         clip-path="url(#clipPath1256)"><text
           transform="matrix(1,0,0,-1,329.05,342.33)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#833c0b;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1260"><tspan
             x="0 4.5214 11.27945 13.528125 21.043751 26.322725"
             y="0"
             sodipodi:role="line"
             id="tspan1258">zn AST</tspan></text></g></g><path
       d="m 376.32,346.26 h 6.75 v -0.01 h 7.08"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1262" /><path
       d="m 389.27,349.77 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1264" /><path
       d="m 212.46,346.26 h 88.01"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1266" /><path
       d="m 299.59,349.78 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1268" /><g
       id="g1272"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1274"
         clip-path="url(#clipPath1278)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,230.83,351.58)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1282"><tspan
             x="0 6.744 12.744 22.511999 28.511999 31.5 34.487999 39.731998 44.220001 46.464001 53.195999"
             y="0"
             sodipodi:role="line"
             id="tspan1280">Compilation</tspan></text></g></g><path
       d="m 76.972,216.57 c 0,10.2 15.598,18.47 34.838,18.47 19.24,0 34.84,-8.27 34.84,-18.47 0,-10.2 -15.6,-18.47 -34.84,-18.47 -19.24,0 -34.838,8.27 -34.838,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1284" /><path
       d="m 76.972,216.57 c 0,10.2 15.598,18.47 34.838,18.47 19.24,0 34.84,-8.27 34.84,-18.47 0,-10.2 -15.6,-18.47 -34.84,-18.47 -19.24,0 -34.838,8.27 -34.838,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1286" /><g
       id="g1288"><g
         id="g1290"
         clip-path="url(#clipPath1294)"><text
           transform="matrix(1,0,0,-1,89.2,212.48)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1298"><tspan
             x="0 6.0004749 11.988925 15.740725 21.729176 26.9841 32.984573 39.718575"
             y="0"
             sodipodi:role="line"
             id="tspan1296">bytecode</tspan></text></g></g><path
       d="M 414.71,327.78 V 247.7 H 63.472 v -31.13 h 7.34"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1300" /><path
       d="m 69.932,220.09 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1302" /><g
       id="g1306"
       style="fill:currentColor;fill-opacity:1"><g
         id="g1308"
         clip-path="url(#clipPath1312)"
         style="fill:currentColor;fill-opacity:1"><text
           transform="matrix(1,0,0,-1,215.58,257.63)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:currentColor;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1316"><tspan
             x="0 6.7340002 12.734475 18.734949 24.7234 27.717625 32.972549 38.960999 45.707024 51.695477 55.459301 61.44775 65.199547 68.181747 74.915749"
             y="0"
             sodipodi:role="line"
             id="tspan1314">Code generation</tspan></text></g></g><path
       d="m 193.95,198.08 h 104.54 l 11.62,36.95 H 205.57 Z"
       style="fill:#deebf6;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1318" /><path
       d="m 193.95,198.08 h 104.54 l 11.62,36.95 H 205.57 Z"
       style="fill:none;stroke:#3955a3;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1320" /><g
       id="g1322"><g
         id="g1324"
         clip-path="url(#clipPath1328)"><text
           transform="matrix(1,0,0,-1,217.68,212.45)"
           style="font-variant:normal;font-weight:normal;font-size:12px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#4672c4;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1332"><tspan
             x="0 3.0239999 9 13.488 19.464001 23.232 29.976 33.720001 39.695999 44.208 49.452 53.939999 56.183998 62.916"
             y="0"
             sodipodi:role="line"
             id="tspan1330">Interpretation</tspan></text></g></g><path
       d="m 146.65,216.57 h 13.5 v -0.02 h 33.45"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1334" /><path
       d="m 192.72,220.07 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1336" /><path
       d="m 396.32,216.56 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1338" /><path
       d="m 396.32,216.56 c 0,10.2 8.24,18.47 18.4,18.47 10.16,0 18.4,-8.27 18.4,-18.47 0,-10.2 -8.24,-18.47 -18.4,-18.47 -10.16,0 -18.4,8.27 -18.4,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1340" /><g
       id="g1342"><g
         id="g1344"
         clip-path="url(#clipPath1348)"><text
           transform="matrix(1,0,0,-1,407.75,212.48)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1352"><tspan
             x="0 3.7638249 8.2852249"
             y="0"
             sodipodi:role="line"
             id="tspan1350">fzn</tspan></text></g></g><path
       d="m 304.3,216.55 h 19.31 v 0.01 h 66.55"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1354" /><path
       d="m 389.28,220.08 7.04,-3.52 -7.04,-3.52 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1356" /><path
       d="m 88.535,155.17 c 0,10.21 8.238,18.48 18.395,18.48 10.17,0 18.4,-8.27 18.4,-18.48 0,-10.2 -8.23,-18.47 -18.4,-18.47 -10.157,0 -18.395,8.27 -18.395,18.47 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1358" /><path
       d="m 88.535,155.17 c 0,10.21 8.238,18.48 18.395,18.48 10.17,0 18.4,-8.27 18.4,-18.48 0,-10.2 -8.23,-18.47 -18.4,-18.47 -10.157,0 -18.395,8.27 -18.395,18.47 z"
       style="fill:none;stroke:#c8c8c8;stroke-width:0.75;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1360" /><g
       id="g1362"><g
         id="g1364"
         clip-path="url(#clipPath1368)"><text
           transform="matrix(1,0,0,-1,98.35,151)"
           style="font-variant:normal;font-weight:normal;font-size:12.025px;font-family:Calibri;-inkscape-font-specification:Calibri;writing-mode:lr-tb;fill:#feffff;fill-opacity:1;fill-rule:nonzero;stroke:none"
           id="text1372"><tspan
             x="0 6.0004749 11.243375"
             y="0"
             sodipodi:role="line"
             id="tspan1370">dzn</tspan></text></g></g><path
       d="m 125.33,155.17 h 120.89 v 36.75"
       style="fill:none;stroke:#4672c4;stroke-width:1;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:2;stroke-dasharray:none;stroke-opacity:1"
       id="path1374" /><path
       d="m 242.7,191.04 3.52,7.04 3.52,-7.04 z"
       style="fill:#4672c4;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path1376" /></g></svg></p>
<h2 id="compilation-phases"><a class="header" href="#compilation-phases">Compilation phases</a></h2>
<ol>
<li><a href="./compilation/parsing.html">Parsing</a><br />
<code>tree-sitter</code> is used to generate a CST from a MiniZinc model.</li>
<li><a href="./compilation/ast-gen.html">MiniZinc AST generation</a><br />
A simple desugaring phase which generates an AST linked to CST.</li>
<li><a href="./compilation/typecheck.html">Type checking</a><br />
Bottom up typechecking, with an additional unification step for dealing with
any remaining unresolved types due to <code>_</code> or <code>&lt;&gt;</code>.</li>
<li><a href="./compilation/type-specialise.html">Type specialisation</a><br />
Monomorphisation of polymorphic functions.</li>
<li><a href="./compilation/transforms.html">MiniZinc AST-to-AST transformations</a><br />
Main desugaring transformation phase.</li>
<li><a href="./compilation/microzinc-gen.html">Compilation to MicroZinc</a><br />
The MiniZinc AST is transformed into MicroZinc AST, which involves
removal of function overloading, rewriting operators into calls,
replacement of variable conditions with an appropriate decomposition, and
removing partiality.</li>
<li><a href="./compilation/bytecode-gen.html">Bytecode generation</a><br />
Code generation of a program which will be interpreted to generate the final
FlatZinc.</li>
<li><a href="./compilation/interpreter.html">Bytecode interpretation</a><br />
The bytecode along with the data is interpreted to produce NanoZinc and later
FlatZinc or any other format for solver backends.</li>
</ol>
<h2 id="compiler-steps"><a class="header" href="#compiler-steps">Compiler steps</a></h2>
<p>These steps need to be fit into the phases.</p>
<ul>
<li>Changing operators into calls</li>
<li>Changing generators into comprehensions</li>
<li>Overloading resolution</li>
<li>Monomorphisation</li>
<li>Decomposition of option types</li>
<li>Removal of partiality</li>
<li>Decomposition of var if-then-else/comprehensions</li>
<li>Type erasure for enums</li>
<li>Closing of functions (need to think about first class functions)</li>
<li>Converting records into tuples</li>
</ul>
<h2 id="query-structure"><a class="header" href="#query-structure">Query structure</a></h2>
<ul>
<li>Discuss the design of the Salsa queries for the compiler.</li>
<li>Think about the level of <a href="https://salsa-rs.github.io/salsa/common_patterns/selection.html">selection queries</a>
required to avoid unnecessary recomputation</li>
<li>What needs to be interned (probably most data structures should be interned)</li>
<li>AST probably needs to use a path as the key to allow for top down queries where the result for a node depends on the
result of its parents</li>
</ul>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<ul>
<li>Compilation to MicroZinc happens without data</li>
<li>Models are compiled with only declarations of standard library functions.
Calls are resolved later by the interpreter, allowing the library to be
swapped out without recompilation.
<ul>
<li>TODO: This may not be possible due to type specialisation</li>
</ul>
</li>
<li>The standard library, and solver redefinition libraries can be distributed
pre-compiled into MicroZinc.
<ul>
<li>TODO: This may not be possible due to type specialisation</li>
</ul>
</li>
<li>The new compiler will use <a href="https://github.com/salsa-rs/salsa">Salsa</a> so that
computed results can be memoised and only updated as needed.</li>
<li>Salsa allows us to use a query based incremental approach to compilation.
Compiler operations should ideally be designed to require as little context as
possible to avoid unnecessary recomputation.</li>
<li>TODO: More discussion of when certain transformations should happen
(e.g. when are enums handled, how is output handled).</li>
<li>Some other compiler projects which may be interesting include
<ul>
<li><a href="https://github.com/dada-lang/dada">Dada</a></li>
<li><a href="https://github.com/mun-lang/mun">Mun</a></li>
<li><a href="https://github.com/quench-lang/quench">Quench</a></li>
<li><a href="https://github.com/Xiulf/shade">Shade</a></li>
<li><a href="https://github.com/DropDemBits/turse-rs">Turse</a></li>
<li><a href="https://github.com/tydi-lang/tydi">Tydi</a></li>
</ul>
</li>
<li>Need to think about what should actually go into MicroZinc (e.g. need <code>case</code>?, what level of nesting is supported?)</li>
<li>For tools which suggest changes to user models, it would be useful to have AST
to CST transformation, so that we can leave the rest of the user model alone
and insert the suggested transformations in place.</li>
<li>Need to think about what AST levels we need. Potentially some or all of:
<ul>
<li>MiniZinc CST</li>
<li>MiniZinc AST</li>
<li>Typed MiniZinc AST</li>
<li>Type specialised MiniZinc AST</li>
<li>Intermediate representation (e.g. Static single assignment form)</li>
<li>MicroZinc AST</li>
</ul>
</li>
<li>Need to think about whether we generate actual data structures for this,
or use queries to introduce new information to a node.</li>
</ul>
<h2 id="project-notes"><a class="header" href="#project-notes">Project notes</a></h2>
<ul>
<li>Steps 1-6 will be the starting point for the compiler. The current MiniZinc
interpreter will be extended to handle MicroZinc (e.g. support for tuples)
to allow for testing of the new frontend.</li>
<li>Steps 7-8 require more research/discussion.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parsing"><a class="header" href="#parsing">Parsing</a></h1>
<p>Tree-sitter is used to generate a concrete syntax tree from a MiniZinc model.</p>
<p>Since this concrete syntax tree is too low level to perform most useful
compilation steps, an abstract syntax tree will be constructed (with the AST
nodes linked to the related CST nodes) during <a href="compilation/ast-gen.html">AST generation</a>.</p>
<h2 id="notes-1"><a class="header" href="#notes-1">Notes</a></h2>
<ul>
<li>Tree-sitter uses the idea of anonymous nodes as a substitute for an AST,
however, this would not solve the problem of e.g. having different concrete
syntax for function generators and comprehensions. Code transformations also
seem to be generally outside the scope of Tree-sitter.</li>
<li>Tree-sitter uses a query system for searching for patterns in the CST. It's
unclear how useful this functionality would be, since it seems like we will
be interacting with an AST we produce be walking the CST instead of with the
CST directly.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minizinc-ast-generation"><a class="header" href="#minizinc-ast-generation">MiniZinc AST generation</a></h1>
<p>After parsing, a MiniZinc AST will be generated from the CST.</p>
<ul>
<li>Whitespace and comments are ignored in the AST</li>
<li>Generators in calls and comprehensions can generate the same AST nodes</li>
</ul>
<p>The AST nodes will need to maintain a link to the CST nodes they originated from
(akin to <code>Location</code>s in the old compiler).</p>
<h2 id="notes-2"><a class="header" href="#notes-2">Notes</a></h2>
<ul>
<li>Using Salsa means that we do not need to include storage for results in the
AST. Instead, these will be stored in the Salsa database and accessed using
queries</li>
<li>When the CST changes, ideally we'd avoid recomputing results about portions of
the AST which haven't changed (which could potentially be the whole AST in the
case of editing whitespace/comments).</li>
<li>Doing this would mean that linking the AST to the CST needs to be considered
carefully.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-checking"><a class="header" href="#type-checking">Type checking</a></h1>
<p>The types for each expression will be determined in a bottom-up fashion. That
is, the types of child nodes are used to determine the type of parent nodes (and
check for correctness). This stage also matches calls with their declarations.</p>
<h2 id="unification"><a class="header" href="#unification">Unification</a></h2>
<p>For literals which have a bottom type (e.g. <code>&lt;&gt;</code>, <code>_</code>, <code>[]</code> and <code>{}</code>), a special
unification step needs to be performed as bottom up typing is not sufficient.
Note that this unification does not perform inference across calls.</p>
<h3 id="variable-assignment-example"><a class="header" href="#variable-assignment-example">Variable assignment example</a></h3>
<pre><code class="language-mzn">array [int] of var opt int: x = [_];
</code></pre>
<p>Bottom up typing will be unable to determine a concrete type for the <code>[&lt;&gt;, _]</code>
literal (although it is known to be <code>var</code>). Instead, the left-hand side type
should be pushed into it, making it an <code>array [int] of var opt int</code>.</p>
<h3 id="function-call-example"><a class="header" href="#function-call-example">Function call example</a></h3>
<pre><code class="language-mzn">test foo(array [int] of var opt int: x, int: y) = true;
test foo(array [int] of var int: x, set of int: y) = false;
constraint foo([_, _], 1);
</code></pre>
<p>Bottom up typing will be unable to determine a type for the <code>[_, _]</code> literal.
In this case, since second argument of the call is an <code>int</code>, only the first
overload of <code>foo</code> is possible. Therefore the type should be
<code>array [int] of var opt int</code>.</p>
<h3 id="ambiguous-types"><a class="header" href="#ambiguous-types">Ambiguous types</a></h3>
<p>When there is not a single unambiguous type for a value, this is considered a
type error.</p>
<pre><code class="language-mzn">test foo(array [int] of var opt $T: x) = true;
constraint foo([_]);
</code></pre>
<p>The type of <code>[_]</code> could be <code>array [int] of var opt int</code> or
<code>array [int] of var opt float</code>, or many others. Therefore, this would be a
type error. To get around this, a variable declaration for <code>[_]</code> could be
used. Otherwise, new syntax for annotating a literal with its type will be
required.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="type-specialisation"><a class="header" href="#type-specialisation">Type specialisation</a></h1>
<p>Calls to polymorphic functions are monomorphised into versions which use
concrete types. Name mangling is used to produce the new declarations (and
allow recovery of the original name).</p>
<h2 id="notes-3"><a class="header" href="#notes-3">Notes</a></h2>
<ul>
<li>If we want to pre-compile the standard library, we will have to monomorphise
any polymorphic functions based on what the possible types for the call
arguments are.
<ul>
<li>Actually this may not be possible because we need monomorphisation to
specialise calls involving enums - and user enums which can be used with
stdlib won't be available if precompiled</li>
<li>Could we compile the model + stdlib separately from the solver library?
Probably not because decompositions in the solver library may use library
functions which need to be specialised</li>
</ul>
</li>
<li>Alternatively we could leave polymorphic functions un-compiled and instead
compile them on the fly.</li>
<li>To start with, the initial implementation should probably just require
compiling the library along with the model.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minizinc-ast-to-ast-transformations"><a class="header" href="#minizinc-ast-to-ast-transformations">MiniZinc AST-to-AST transformations</a></h1>
<p>In this phase, more complex desugaring operations are performed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compilation-to-microzinc"><a class="header" href="#compilation-to-microzinc">Compilation to MicroZinc</a></h1>
<p>Compilation of the MiniZinc AST to MicroZinc will involve transformation to
a new AST for MicroZinc.</p>
<h2 id="replacing-operators-by-function-calls"><a class="header" href="#replacing-operators-by-function-calls">Replacing operators by function calls</a></h2>
<p>Operators need to be replaced by calls.</p>
<h2 id="decomposition-of-variable-conditionals"><a class="header" href="#decomposition-of-variable-conditionals">Decomposition of variable conditionals</a></h2>
<p><code>if-then-else</code> expressions with a variable condition need to be rewritten into
function calls.</p>
<h2 id="lifting-partiality"><a class="header" href="#lifting-partiality">Lifting partiality</a></h2>
<p>Partial functions need to transformed into total functions.</p>
<h2 id="subtype-based-overloading"><a class="header" href="#subtype-based-overloading">Subtype based overloading</a></h2>
<p>As functions arguments also accept their subtypes, these should be transformed
to dispatch to their specialised counterparts.</p>
<h2 id="pass-values-from-outer-scopes-of-functions-through-parameters"><a class="header" href="#pass-values-from-outer-scopes-of-functions-through-parameters">Pass values from outer scopes of functions through parameters</a></h2>
<p>Functions which refer to variables outside the scope of the function need to be
transformed such that these variables are passed as arguments to the function.</p>
<h2 id="generation-of-the-main-entrypoint"><a class="header" href="#generation-of-the-main-entrypoint">Generation of the main entrypoint</a></h2>
<p>MicroZinc uses a top-level function <code>main</code> as its entrypoint for the interpreter.</p>
<p>The top-level decision variable and constraints are added as a <code>let</code> expression
in this function, taking the model parameters as arguments.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bytecode-generation"><a class="header" href="#bytecode-generation">Bytecode generation</a></h1>
<h2 id="output-generation"><a class="header" href="#output-generation">Output generation</a></h2>
<p>Some kind of code which maps from FlatZinc output variables to user model
output should be generated similarly to how we generate <code>.ozn</code> output models
currently.</p>
<p>This functionality could be extended to allow for mapping of other solver
information such as statistics, duals, etc to report these in the context of
the user model.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bytecode-interpretation"><a class="header" href="#bytecode-interpretation">Bytecode interpretation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="microzinc-specification"><a class="header" href="#microzinc-specification">MicroZinc specification</a></h1>
<p>MicroZinc is a simple language used to define transformations to be performed
by the interpreter. It is a simplified subset of MiniZinc. The transformation
are represented in the language through the use of function definitions. A
function of type <code>var bool</code>, describing a relation, can be defined as a
native constraint. Otherwise, a function body must be provided for
rewriting. The function body can use a restriction of the MiniZinc expression
language. An important difference between MiniZinc and MicroZinc is that a
well-formed <em>MicroZinc does not contain partial expressions</em>. Any partiality in
the MiniZinc model must be explicitly expressed using total functions in
MicroZinc. As such, constraints introduced in MicroZinc let expressions can
be globally enforced. They are guaranteed to only constrain the decision
variables introduced in the same let expression.</p>
<h3 id="todo-remaining-questions"><a class="header" href="#todo-remaining-questions">TODO: Remaining questions</a></h3>
<ul>
<li>What annotation operations should be allowed in MicroZinc?</li>
<li>The operational semantics for array access definition only works for 1-dimensional arrays. How can we generalise them for multiple dimensions?</li>
<li>Add list of built-in functions</li>
</ul>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<p>MicroZinc is defined using the following syntax,</p>
<p>\[
\begin{array}{lcl}
\mathit{program} &amp;::=&amp;
\mathit{func}* \\
\mathit{func} &amp;::=&amp;
\mathsf{function}<del>\mathit{typeinst}</del>\mathsf{:}<del>\mathit{ident}</del>\mathsf{(}\mathit{typing} [\mathsf{,}~ \mathit{typing}]*\mathsf{)}<del>[\mathsf{=}</del>\mathit{letExpr}]\mathsf{;}\\&amp;|&amp;
\mathsf{predicate}<del>\mathit{ident}</del>\mathsf{(}\mathit{typing} [\mathsf{,}~ \mathit{typing}]*\mathsf{)}<del>[\mathsf{=}</del>\mathit{letRoot}]\mathsf{;} \\
\mathit{typing} &amp;::=&amp;
\mathit{typeinst}<del>\mathsf{:}</del>\mathit{ident} \\
\\
\mathit{expr} &amp;::=&amp;
\mathit{letExpr} \\&amp;|&amp;
\mathit{ident}<del>\mathsf{(}\mathit{val} [ \mathsf{,}</del> \mathit{val}]*\mathsf{)} \\&amp;|&amp;
\mathsf{if}<del>\mathit{val}</del>\mathsf{then}<del>\mathit{letExpr}</del>[\mathsf{elseif}<del>\mathit{val}</del>\mathsf{then}<del>\mathit{letExpr}]*</del>\mathsf{else}<del>\mathit{letExpr}</del>\mathsf{endif} \\&amp;|&amp;
\mathsf{[}[\mathit{tuple}\mathsf{:}]<del>\mathit{letExpr}</del>\mathsf{|}<del>\mathit{genExpr} [ \mathsf{,}</del> \mathit{genExpr}]*\mathsf{]} \\
\mathit{rootExpr} &amp;::=&amp;
\mathit{letRoot} \\&amp;|&amp;
\mathit{ident}<del>\mathsf{(}\mathit{val} [ \mathsf{,}</del> \mathit{val}]*\mathsf{)} \\&amp;|&amp;
\mathsf{if}<del>\mathit{val}</del>\mathsf{then}<del>\mathit{letRoot}</del>[\mathsf{elseif}<del>\mathit{val}</del>\mathsf{then}<del>\mathit{letRoot}]*</del>\mathsf{else}<del>\mathit{letRoot}</del>\mathsf{endif} \\&amp;|&amp;
\mathsf{forall<em>root}\mathsf{(}\mathsf{[}\mathit{letRoot}<del>\mathsf{|}</del>\mathit{genExpr} [ \mathsf{,}~ \mathit{genExpr}]*\mathsf{]}\mathsf{)} \\
\mathit{letExpr} &amp;::=&amp;
\mathit{val} \\&amp;|&amp;
\mathsf{let}<del>\mathsf{\{}\mathit{item}*\mathsf{\}}</del>\mathsf{in}<del>\mathit{val} \\
\mathit{letRoot} &amp;::=&amp;
\mathsf{let}</del>\mathsf{\{}\mathit{item}*\mathsf{\}}<del>\mathsf{in}</del>\mathsf{root} \\
\mathit{item} &amp;::=&amp;
\mathit{typing}<del>\mathsf{;} \\&amp;|&amp;
\mathit{typing}</del>\mathsf{=}<del>\mathit{expr}</del>\mathsf{;} \\&amp;|&amp;
\mathsf{constraint}<del>\mathit{rootExpr}</del>\mathsf{;} \\
\mathit{genExpr} &amp;::=&amp;
\mathit{ident}<del>\mathsf{in}</del>\mathit{letExpr}<del>[\mathsf{where}</del>\mathit{letExpr}] \\&amp;|&amp;
\mathit{ident}<del>\mathsf{=}</del>\mathit{letExpr} \\
\mathit{val} &amp;::=&amp;
\mathit{lit}<del>|</del>\mathit{range}<del>|</del>\mathit{tuple} \\&amp;|&amp;
\mathsf{\{}\mathit{lit}<del>\mathsf{,}</del> [\mathit{lit}<del>\mathsf{,}]*\mathsf{\}} \\&amp;|&amp;
\mathsf{array}\mathit{int}\mathsf{d(}\mathit{range}</del>\mathsf{,}<del>[\mathit{range}</del>\mathsf{,}]*<del>\mathsf{[}\mathit{lit}</del>\mathsf{,}~ [\mathit{lit}<del>\mathsf{,}]*\mathsf{])} \\&amp;|&amp;
\mathit{ident}</del>\mathsf{.}<del>\mathit{int} \\&amp;|&amp;
\mathit{ident}</del>\mathsf{[}\mathit{lit}\mathsf{]} \\
\mathit{tuple} &amp;::=&amp;
\mathsf{(}\mathit{lit}<del>\mathsf{,}</del> [\mathit{lit}<del>\mathsf{,}]*\mathsf{)} \\
\mathit{range} &amp;::=&amp;
\mathit{lit}\mathsf{..}\mathit{lit} \\&amp;|&amp;
\mathit{ident} \\
\mathit{lit} &amp;::=&amp;
\mathit{bool} \\&amp;|&amp;
\mathit{int} \\&amp;|&amp;
\mathit{float} \\&amp;|&amp;
\mathit{str} \\&amp;|&amp;
\mathit{ident} \\
\\
\mathit{bool} &amp;::=&amp;
\mathsf{true}</del>|~\mathsf{false} \\
\mathit{int} &amp;::=&amp;
/\texttt{[0-9]+}/ \\
\mathit{float} &amp;::=&amp;
/\texttt{0[xX]([0-9a-fA-F]*\.[0-9a-fA-F]+)|([0-9a-fA-F]+\.?)([pP][+-]?[0-9]+)?}/ \\
\mathit{str} &amp;::=&amp;
/\texttt{&quot;[^&quot;]*&quot;}/ \\
\mathit{ident} &amp;::=&amp;
/\texttt{[A-Za-z]A-Za-z0-9</em>]*}/ \\
\end{array}
\]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-typing-rules-of-microzinc"><a class="header" href="#the-typing-rules-of-microzinc">The Typing Rules of MicroZinc</a></h1>
<p>The following syntax describes the types available in MicroZinc. The type syntax are used directly in let-expressions and parameter declarations.</p>
<p>\[
\begin{array}{lcl}
\mathit{typeinst} &amp;::=&amp;
\mathsf{pred} \\&amp;|&amp;
\mathsf{array}<del>\mathsf{[}\mathit{int}\mathsf{..}\mathit{int} [ \mathsf{,}</del> \mathit{int}\mathsf{..}\mathit{int}]*\mathsf{]}<del>\mathsf{of}</del>\mathit{baseType} \\&amp;|&amp;
\mathit{baseType} \\
\mathit{baseType} &amp;::=&amp;
\mathsf{tuple}<del>\mathsf{(}\mathit{typeinst} [ \mathsf{,}</del> \mathit{typeinst}]*\mathsf{)} \\&amp;|&amp;
\mathit{domType} \\&amp;|&amp;
\mathit{primType} \\
\mathit{domType} &amp;::=&amp;
\mathsf{var}<del>\mathit{val}\\&amp;|&amp;
\mathsf{var}</del>\mathsf{set}<del>\mathsf{of}</del>\mathit{val}\\
\mathit{primType} &amp;::=&amp;
\mathsf{par}<del>\mathsf{bool}</del>|<del>\mathsf{var}</del>\mathsf{bool}\\&amp;|&amp;
\mathsf{par}<del>\mathsf{int}</del>|<del>\mathsf{var}</del>\mathsf{int}\\&amp;|&amp;
\mathsf{par}<del>\mathsf{float}</del>|<del>\mathsf{var}</del>\mathsf{float}\\&amp;|&amp;
\mathsf{par}<del>\mathsf{set}</del>\mathsf{of}<del>\mathsf{int}</del>|<del>\mathsf{var}</del>\mathsf{set}<del>\mathsf{of}</del>\mathsf{int}\\&amp;|&amp;
\mathsf{par}<del>\mathsf{set}</del>\mathsf{of}<del>\mathsf{float}</del>|~\mathsf{string}
\end{array}
\]</p>
<p>Importantly, MicroZinc includes two types of sub-typing. When type \( T_1 \) is a sub-type of type \( T_2 \) then \( T_1 \) can be used anywhere where the type \( T_2 \) is required.</p>
<ul>
<li>In MicroZinc, \( \mathsf{par}~T \) is a sub-type of \( \mathsf{var}~T \).</li>
<li>MicroZinc also has numeric subtyping (i.e., \( \mathsf{par~bool} \) is a subtype of \( \mathsf{par~int} \), which is a sub-type of \( \mathsf{par~float} \), and similarly \( \mathsf{var~bool} \) is a sub-type of \( \mathsf{var~int} \), which is a sub-type of \( \mathsf{var~float} \))</li>
</ul>
<p>The \( \mathsf{pred} \) type is a special value given to expressions that enforce constraints, but do not return a value. This It should be noted that the</p>
<p>The following rules describe the conditions under which a MicroZinc program is correctly typed. In these rules the variable \( \Gamma \) will denote the typing context. This context contains known types for identifiers.</p>
<h3 id="functions-and-calls"><a class="header" href="#functions-and-calls">Functions and calls</a></h3>
<p>At the top level of the MicroZinc program we find different functions. The program is well-typed if the type of the body of each function matches the declared type of the function given the declared types for the arguments. The types of all functions are available when typing the body expression of a function, allowing for (mutual) recursive functions.</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} T : T^r$}
\AxiomC{$ \Gamma, f^{id} : (T'_1 \equiv )\langle T^p_1, \dots, T^p_n \rangle \rightarrow T^{r}\vdash{} funcs : \langle T'_2, \dots, T'_m \rangle $}
\RightLabel{(T-Builtin)}
\BinaryInfC{$ \vdash{} \mathsf{function}<del>T</del>\mathsf{:}<del>f^{id}</del>\mathsf{(} T^p_1 : x_1\mathsf{,}\dots\mathsf{,}T^p_n : x_n\mathsf{)}~\mathsf{;} funcs : \langle T'_1, \dots, T'_m \rangle $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} T : T^r$}
\AxiomC{$ \Gamma, f^{id}_1 : (T'_1 \equiv) \langle T^p_1, \dots, T^p_n \rangle \rightarrow T^r \vdash{} f_2 \mathsf{;} \dots \mathsf{;} f_m : \langle T'_2, \dots, T'_m \rangle $}
\noLine{}
\BinaryInfC{$\Gamma, f^{id}_1 : T'_1, \dots, f^{id}_m : T'_m, x_1 : T^p_1, \dots, x_n : T^p_n \vdash{} E : T^r$}
\RightLabel{(T-Func)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{function}<del>T</del>\mathsf{:}<del>f^{id}_1</del>\mathsf{(}<del>x_1: T^p_1, \dots, x_n: T^p_n \mathsf{)}</del>\mathsf{=}<del>E</del>\mathsf{;} f_2 \mathsf{;} \dots \mathsf{;} f_m : \langle T'_1, \dots, T'_m \rangle $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma, f^{id} : (T'_1 \equiv )\langle T^p_1, \dots, T^p_n \rangle \rightarrow \mathsf{pred}\vdash{} funcs : \langle T'_2, \dots, T'_m \rangle $}
\RightLabel{(T-Slv-Native)}
\UnaryInfC{$ \vdash{} \mathsf{predicate}<del>f^{id}</del>\mathsf{(} T^p_1 : x_1\mathsf{,}\dots\mathsf{,}T^p_n : x_n\mathsf{)}~\mathsf{;} funcs : \langle T'_1, \dots, T'_m \rangle $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma, f^{id}_1 : (T'_1 \equiv) \langle T^p_1, \dots, T^p_n \rangle \rightarrow \mathsf{pred} \vdash{} f_2 \mathsf{;} \dots \mathsf{;} f_m : \langle T'_2, \dots, T'_m \rangle $}
\noLine{}
\UnaryInfC{$\Gamma, f^{id}_1 : T'_1, \dots, f^{id}_m : T'_m, x_1 : T^p_1, \dots, x_n : T^p_n \vdash{} E : \mathsf{par~bool}$}
\RightLabel{(T-Pred)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{function}<del>T</del>\mathsf{:}<del>f^{id}_1</del>\mathsf{(}<del>x_1: T^p_1, \dots, x_n: T^p_n \mathsf{)}</del>\mathsf{=}<del>E</del>\mathsf{;} f_2 \mathsf{;} \dots \mathsf{;} f_m : \langle T'_1, \dots, T'_m \rangle $}
\end{prooftree}
\]</p>
<p>Calls are defined in both the context of a constraint and on the right hand side of an assignment of a let-expression. In both cases the typing of call is described by the following rule.</p>
<p>\[
\begin{prooftree}
\AxiomC{$ f^{id} : \langle T^p_1, \dots, T^p_n \rangle \rightarrow T^r \in \Gamma$}
\AxiomC{$ \Gamma \vdash{} x_1 : T^p_1 ~~ \dots ~~ \Gamma \vdash{} x_n : T^p_n$}
\RightLabel{(T-Call)}
\BinaryInfC{$ \Gamma \vdash{} f^{id} ~\mathsf{(}<del>x_1 \mathsf{,} \dots \mathsf{,} x_n</del>\mathsf{)} : T^r $}
\end{prooftree}
\]</p>
<h3 id="let-expressions-and-identifiers"><a class="header" href="#let-expressions-and-identifiers">Let expressions and identifiers</a></h3>
<p>Identifiers are typed simply using a lookup in the typing context. The typing of the let expression iteratively adds the types of each declaration item to the typing context. The program is well-typed when all expressions on the right-hand side of a declaration match their declared types, and any constraint items are of \( \mathsf{pred} \) type.</p>
<p>\[
\begin{prooftree}
\AxiomC{$ x : T \in \Gamma $}
\RightLabel{(T-Ident)}
\UnaryInfC{$ \Gamma \vdash{} x : T$}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} x : T$}
\RightLabel{(T-Let-Base)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{let}<del>\mathsf{\{}</del>\mathsf{\}}<del>\mathsf{in}</del>\mathit{x} : T$}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} T : T'$}
\AxiomC{$ \Gamma, x : T' \vdash{} \mathsf{let}<del>\mathsf{\{}<del>items</del>\mathsf{\}}</del>\mathsf{in}<del>y : T''$}
\RightLabel{(T-Let-Decl1)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{let}</del>\mathsf{\{}<del>T</del>\mathsf{:}<del>x</del>\mathsf{;}<del>items</del>\mathsf{\}}~\mathsf{in}~y : T''$}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} T : T'$}
\AxiomC{$ \Gamma \vdash{} E : T'$}
\AxiomC{$ \Gamma, x : T' \vdash{} \mathsf{let}<del>\mathsf{\{}<del>items</del>\mathsf{\}}</del>\mathsf{in}<del>y : T''$}
\RightLabel{(T-Let-Decl2)}
\TrinaryInfC{$ \Gamma \vdash{} \mathsf{let}</del>\mathsf{\{}<del>T</del>\mathsf{:}<del>x = E</del>\mathsf{;}<del>items</del>\mathsf{\}}~\mathsf{in}~y : T''$}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} E : \mathsf{pred}$}
\AxiomC{$ \Gamma, x : T \vdash{} \mathsf{let}<del>\mathsf{\{}<del>items</del>\mathsf{\}}</del>\mathsf{in}<del>y : T'$}
\RightLabel{(T-Let-Con)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{let}</del>\mathsf{\{}<del>\mathsf{constraint}<del>E</del>\mathsf{;}<del>items</del>\mathsf{\}}</del>\mathsf{in}~y : T'$}
\end{prooftree}
\]</p>
<h3 id="comprehensions-and-generators"><a class="header" href="#comprehensions-and-generators">Comprehensions and Generators</a></h3>
<p>As shown in the following rules, the \( \mathit{genExpr} \) rules will must have either type \( \mathsf{set~of~int} \) or \( \mathsf{array1d~of}~T \). The \( \text{T_Comp} \) rule, to type array comprehensions, will use the \( elem \) function which maps the former type to \( \mathsf{int} \) and the latter to \( T \).</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma, \vdash{} E : T$}
\RightLabel{(T-Comp-Expr)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{[} E~\mathsf{|}<del>\mathsf{]} : \mathsf{array1d~of</del>} T $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} I : T$}
\AxiomC{$ T \in \{ \mathsf{set~of~int}, \mathsf{array1d~of}<del>V \}$}
\AxiomC{$ \Gamma, x : T \vdash{} \mathsf{[} E</del>\mathsf{|}<del>gens</del>\mathsf{]} : T' $}
\RightLabel{(T-Comp-In)}
\TrinaryInfC{$ \Gamma \vdash{} \mathsf{[} E~\mathsf{|}<del>x</del>\mathsf{in}<del>I, gens</del>\mathsf{]} : T' $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} B : \mathsf{par~bool}$}
\AxiomC{$ \Gamma \vdash{} \mathsf{[} E~\mathsf{|}<del>x</del>\mathsf{in}<del>I, gens</del>\mathsf{]} : T $}
\RightLabel{(T-Comp-Where)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{[} E~\mathsf{|}<del>x</del>\mathsf{in}<del>I</del>\mathsf{where}<del>B, gens</del>\mathsf{]} : T $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} E_2 : T$}
\AxiomC{$ \Gamma, x : T \vdash{} \mathsf{[} E_1~\mathsf{|}<del>gens</del>\mathsf{]} : T' $}
\RightLabel{(T-Comp-Asg)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{[} E_1~\mathsf{|}<del>x</del>\mathsf{=}<del>E_2, gens</del>\mathsf{]} : T' $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma\vdash{} \mathsf{[} I_i~\mathsf{|}<del>gens</del>\mathsf{]} : \mathsf{array1d~of~int}, \forall{} 1 \leq{} i \leq{} X$}
\AxiomC{$ \Gamma\vdash{} \mathsf{[} E~\mathsf{|}<del>gens</del>\mathsf{]} : \mathsf{array1d~of}<del>T $}
\RightLabel{(T-Comp-Ind)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{[(}I_1, \dots, I_X \mathsf{):} E</del>\mathsf{|}gens~\mathsf{]} : \mathsf{array}X\mathsf{d~of}~T $}
\end{prooftree}
\]</p>
<h3 id="arrays-sets-and-tuples"><a class="header" href="#arrays-sets-and-tuples">Arrays, Sets, and Tuples</a></h3>
<p>MicroZinc has three different container types. Arrays can contain multiple, possibly duplicate, elements of the same type, each associated with a unique index with which the element can be retrieved.</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} r_i : \mathsf{par~set~of~int}, \forall{} 1 \leq{} i \leq{} X$}
\AxiomC{$ \Gamma \vdash{} x_i : T, \forall{} 1 \leq{} i \leq{} n$}
\RightLabel{(T-Arr)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{array}X\mathsf{d(}~r_1 \mathsf{,} \dots \mathsf{,} r_X \mathsf{,} \mathsf{[} x_1 \mathsf{,} \dots \mathsf{,} x_n \mathsf{])} : \mathsf{array}X\mathsf{d~of}~T $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} v_i : \mathsf{par}~\mathsf{int}, \forall{} 1 \leq{} i \leq{} X$}
\AxiomC{$ \Gamma \vdash{} x : \mathsf{array}X\mathsf{d~of}~T$}
\RightLabel{(T-Ind)}
\BinaryInfC{$ \Gamma \vdash{} x \mathsf{[} v_1 \mathsf{,} \dots \mathsf{,} v_X \mathsf{]} : T $}
\end{prooftree}
\]</p>
<p>Sets contain a certain number of unique elements of the same type. Ranges of elements are also typed as sets.</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} x_1 : T, \forall{} 1 \leq{} i \leq{} n$}
\AxiomC{$ T \in {\mathsf{par~int}, \mathsf{par~float}}$}
\RightLabel{(T-Set)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{\{} x_1 \mathsf{,} \dots \mathsf{,} x_n \mathsf{\}} : \mathsf{par~set~of}~T $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} x_1 : T $}
\AxiomC{$ \Gamma \vdash{} x_2 : T $}
\AxiomC{$ T \in {\mathsf{par~int}, \mathsf{par~float}}$}
\RightLabel{(T-Range)}
\TrinaryInfC{$ \Gamma \vdash{} x_1 \mathsf{..} x_2 : \mathsf{par~set~of}~T $}
\end{prooftree}
\]</p>
<p>Finally, tuples are collections of elements with possibly different types. The number of elements in a tuple is known during type checking</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} x_i : T_i, \forall{} 1 \leq{} i \leq{} n$}
\RightLabel{(T-Tup)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{(} x_1\mathsf{,} \dots\mathsf{,} x_n \mathsf{)} : \mathsf{tuple(} T_1 \mathsf{,} \dots \mathsf{,} T_n \mathsf{)}$}
\end{prooftree}
\]
\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} x : \mathsf{tuple(} T_1 \mathsf{,} \dots \mathsf{,} T_i \mathsf{,} \dots \mathsf{,} T_n \mathsf{)}$}
\AxiomC{$ i \in 1 \mathsf{..} n $}
\RightLabel{(T-Acc)}
\BinaryInfC{$ \Gamma \vdash{} x \mathsf{.} i : T_i $}
\end{prooftree}
\]</p>
<h3 id="if-then-else-expressions"><a class="header" href="#if-then-else-expressions">If-then-else Expressions</a></h3>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} x : \mathsf{par}~\mathsf{bool} $}
\AxiomC{$ \Gamma \vdash{} E_1 : T$}
\AxiomC{$ \Gamma \vdash{} E_2 : T$}
\RightLabel{(T-If)}
\TrinaryInfC{$ \Gamma \vdash{} \mathsf{if}<del>x</del>\mathsf{then}<del>E_1</del>\mathsf{else}<del>E_2</del>\mathsf{endif} : T $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} x_1 : \mathsf{par}~\mathsf{bool} $}
\AxiomC{$ \Gamma \vdash{} E_1 : T$}
\AxiomC{$ \Gamma \vdash{} \mathsf{if}<del>x_2</del>\mathsf{then}~E_2 \dots \mathsf{else}<del>E_n</del>\mathsf{endif} : T$}
\RightLabel{(T-ElseIf)}
\TrinaryInfC{$ \Gamma \vdash{} \mathsf{if}<del>x_1</del>\mathsf{then}<del>E_1</del>\mathsf{elseif}<del>x_2</del>\mathsf{then}~E_2 \dots \mathsf{else}<del>E_n</del>\mathsf{endif} : T $}
\end{prooftree}
\]</p>
<h3 id="literals"><a class="header" href="#literals">Literals</a></h3>
<p>The remaining parts of the MicroZinc laguage are simple literals that have an intrinsic type.</p>
<p>\[
\begin{prooftree}
\AxiomC{}
\RightLabel{(T-Root)}
\UnaryInfC{$\vdash{} \mathsf{root} : \mathsf{pred}$}
\end{prooftree}
\begin{prooftree}
\AxiomC{}
\RightLabel{(T-True)}
\UnaryInfC{$\vdash{} \mathsf{true} : \mathsf{par}<del>\mathsf{bool}$}
\end{prooftree}
\begin{prooftree}
\AxiomC{}
\RightLabel{(T-False)}
\UnaryInfC{$\vdash{} \mathsf{false} : \mathsf{par}</del>\mathsf{bool}$}
\end{prooftree}
\]
\[
\begin{prooftree}
\AxiomC{}
\RightLabel{(T-int)}
\UnaryInfC{$\vdash{} /\texttt{[0-9]+}/ : \mathsf{par}<del>\mathsf{int}$}
\end{prooftree}
\begin{prooftree}
\AxiomC{}
\RightLabel{(T-Str)}
\UnaryInfC{$\vdash{} /\texttt{&quot;[^&quot;]*&quot;}/ : \mathsf{string}$}
\end{prooftree}
\]
\[
\begin{prooftree}
\AxiomC{}
\RightLabel{(T-float)}
\UnaryInfC{$\vdash{} /\texttt{0[xX]([0-9a-fA-F]*\.[0-9a-fA-F]+)|([0-9a-fA-F]+\.?)([pP][+-]?[0-9]+)?}/ : \mathsf{par}</del>\mathsf{float}$}
\end{prooftree}
\]</p>
<h3 id="type-instances"><a class="header" href="#type-instances">Type Instances</a></h3>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} I_i : \mathsf{par}<del>\mathsf{set}</del>\mathsf{of}<del>\mathsf{int}, \forall{} 1 \leq{} i \leq{} X$}
\AxiomC{$ \Gamma \vdash{} T : T'$}
\RightLabel{(T-Type-Arr)}
\BinaryInfC{$ \Gamma \vdash{} \mathsf{array}</del>\mathsf{[}I_1 \mathsf{,} \dots, I_X\mathsf{]}<del>\mathsf{of}</del>\mathit{T} : \mathsf{array}X\mathsf{d~of}~T' $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} T_1 : T'_1 ~~ \dots ~~ \Gamma \vdash{} T_n : T'_n$}
\RightLabel{(T-Type-Tup)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{tuple}\mathsf{(}\mathit{T_1}\mathsf{,} \dots, T_n\mathsf{)} : \mathsf{tuple(}T'_1, \dots, T'_n\mathsf{)} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} S : \mathsf{par}<del>\mathsf{set}</del>\mathsf{of}<del>\mathsf{int}$}
\RightLabel{(T-Int-Dom)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{var}<del>S : \mathsf{var}</del>\mathsf{int} $}
\end{prooftree}
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} S : \mathsf{par}</del>\mathsf{set}<del>\mathsf{of}</del>\mathsf{float}$}
\RightLabel{(T-Flt-Dom)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{var}<del>S : \mathsf{var}</del>\mathsf{float} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Gamma \vdash{} S : \mathsf{par}<del>\mathsf{set}</del>\mathsf{of}<del>\mathsf{int}$}
\RightLabel{(T-Set-Dom)}
\UnaryInfC{$ \Gamma \vdash{} \mathsf{var}</del>\mathsf{set}<del>\mathsf{of}<del>S : \mathsf{var}</del>\mathsf{set}</del>\mathsf{of}~\mathsf{int} $}
\end{prooftree}
\]</p>
<p>The remaining variants (\( \mathit{primType} \)) are trivial, and their expression directly describes their type.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-operational-semantics-of-microzinc"><a class="header" href="#the-operational-semantics-of-microzinc">The Operational Semantics of MicroZinc</a></h1>
<p>Note that only function calls and the items in let expressions change the environment.</p>
<p>\(
\def\tuple#1{\left\langle #1 \right\rangle}
\def\Sem#1#2{[\![#1]\!]\tuple{#2}}
\def\SemLet#1#2{[\![#1]\!]_L\tuple{#2}}
\def\Prog\ensuremath{\mathcal{P}}
\def\Env\ensuremath{\sigma}
\)</p>
<h3 id="function-calls"><a class="header" href="#function-calls">Function calls</a></h3>
<p>\[
\begin{prooftree}
\AxiomC{$ \mathsf{function}~T\mathsf{:}<del>F\mathsf{(} p*1, \dots, p_k \mathsf{)} = E; \in{} \Prog{},</del>\text{where the}<del>p_i</del>\text{are fresh} $}
\AxiomC{$ \Sem{E*{[p_i \mapsto a_i, \forall{} 1 \leq{} i \leq{} k]}}{\Prog, \Env} \Rightarrow{} \tuple{v, \Env'} $}
\RightLabel{(E-Call)}
\BinaryInfC{$ \Sem{F\mathsf{(}a_1, \ldots, a_k\mathsf{)}}{\Prog, \Env, C} \Rightarrow{} \tuple{v, \Env'} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ F \in \text{Builtins} $}
\RightLabel{(E-Call-Builtin)}
\UnaryInfC{$ \Sem{F\mathsf{(}a_1, \ldots, a_k\mathsf{)}}{\Prog, \Env} \Rightarrow{} \tuple{\mathit{eval}(F, \langle a_1, \dots, a_k \rangle), \Env'} $}
\end{prooftree}
\]</p>
<p>TODO: The following rule comes from my thesis to call a native constraint, but I'm not sure if it works correctly when you have a functionally defined Boolean variable (call on RHS).</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \mathsf{function~var~bool:}<del>F\mathsf{(}p_1, \ldots, p_k\mathsf{)}; \in \Prog $}
\RightLabel{(E-Call-Native)}
\UnaryInfC{$ \Sem{F\mathsf{(}a_1, \ldots, a_k\mathsf{)}}{\Prog, \Env} \Rightarrow{} \tuple{\mathsf{constraint}</del> F\mathsf{(}a_1, \ldots, a_k\mathsf{)}, \Env} $}
\end{prooftree}
\]</p>
<h3 id="let-expressions"><a class="header" href="#let-expressions">Let expressions</a></h3>
<p>Constraint in let-expression are aggregated and bound to the returned variable. As such, let expressions are evaluated with an addition context collection \( C \), which contains the constraints enforced in the let-expression. Evaluation rules that use this special context are indicated using \( L \).</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \SemLet{\mathsf{let}<del>\mathsf{\{}<del>items</del>\mathsf{\}}</del>\mathsf{in}<del>y}{\Prog, \Env, \emptyset} \Rightarrow \tuple{x, \Env'} $}
\RightLabel{(E-Let)}
\UnaryInfC{$ \Sem{\mathsf{let}</del>\mathsf{\{}<del>items</del>\mathsf{\}}~\mathsf{in}~y}{\Prog, \Env} \Rightarrow{} \tuple{x, \Env'} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{y}{\Prog, \Env} \Rightarrow \tuple{x, \Env} $}
\RightLabel{(E-Let-In)}
\UnaryInfC{$ \SemLet{\mathsf{let}<del>\mathsf{\{}\mathsf{\}}</del>\mathsf{in}<del>y}{\Prog, \Env, C} \Rightarrow{} \tuple{x, \Env \cup x</del>\texttt{↳}~C} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{E}{\Prog, \Env} \Rightarrow \tuple{c, \Env'} $}
\AxiomC{$ \SemLet{\mathsf{let}<del>\mathsf{\{}<del>items</del>\mathsf{\}}</del>\mathsf{in}<del>y}{\Prog, \Env', C \cup c} \Rightarrow{} \tuple{x, \Env''} $}
\RightLabel{(E-Let-Con)}
\BinaryInfC{$ \SemLet{\mathsf{let}</del>\mathsf{\{}<del>\mathsf{constraint}<del>E</del>\mathsf{;}<del>items</del>\mathsf{\}}</del>\mathsf{in}~y}{\Prog, \Env, C} \Rightarrow{} \tuple{x, \Env''} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \SemLet{\mathsf{let}<del>\mathsf{\{}<del>items</del>\mathsf{\}}</del>\mathsf{in}<del>y}{\Prog, \Env \cup {T: x}, C} \Rightarrow{} \tuple{x, \Env'} $}
\RightLabel{(E-Let-Decl1)}
\UnaryInfC{$ \SemLet{\mathsf{let}</del>\mathsf{\{}<del>T</del>\mathsf{:}<del>x</del>\mathsf{;}<del>items</del>\mathsf{\}}~\mathsf{in}~y}{\Prog, \Env, C} \Rightarrow{} \tuple{x, \Env'} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{E}{\Prog, \Env} \Rightarrow \tuple{v, \Env'} $}
\AxiomC{$ \SemLet{\mathsf{let}<del>\mathsf{\{}<del>items*{[x \mapsto v]}</del>\mathsf{\}}</del>\mathsf{in}<del>y*{[x \mapsto v]}}{\Prog, \Env', C} \Rightarrow{} \tuple{x, \Env''} $}
\RightLabel{(E-Let-Decl2)}
\BinaryInfC{$ \SemLet{\mathsf{let}</del>\mathsf{\{}<del>T</del>\mathsf{:}<del>x = E</del>\mathsf{;}<del>items</del>\mathsf{\}}~\mathsf{in}~y}{\Prog, \Env, C} \Rightarrow{} \tuple{x, \Env''} $}
\end{prooftree}
\]</p>
<h3 id="comprehensions-and-generators-1"><a class="header" href="#comprehensions-and-generators-1">Comprehensions and Generators</a></h3>
<p>\[
\begin{prooftree}
\AxiomC{}
\RightLabel{(T-Comp-NoGen)}
\UnaryInfC{$ \Sem{\mathsf{[} E \mathsf{|}~\mathsf{]}}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{[ ]}, \Env} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{I}{\Prog, \Env} \Rightarrow \tuple{\mathsf{[ ]}, \Env'} $}
\RightLabel{(T-Comp-Empty)}
\UnaryInfC{$ \Sem{\mathsf{[} E \mathsf{|}<del>x</del>\mathsf{in}<del>I</del>\mathsf{where}<del>B, gens</del>\mathsf{]}}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{[ ]}, \Env} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{I}{\Prog, \Env} \Rightarrow \tuple{\mathsf{[}v_1~\mathsf{]}, \Env'} $}
\RightLabel{(T-Comp-It)}
\UnaryInfC{$ \Sem{\mathsf{[} E \mathsf{|}<del>x</del>\mathsf{in}<del>I</del>\mathsf{where}<del>B, gens</del>\mathsf{]}}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{[ ]}, \Env} $}
\end{prooftree}
\]</p>
<h3 id="tuples-and-arrays"><a class="header" href="#tuples-and-arrays">Tuples and Arrays</a></h3>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{x}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{(} v_1\mathsf{,} \dots\mathsf{,} v_n \mathsf{)}, \Env} $}
\AxiomC{$ i \in 1 \mathsf{..} n$}
\RightLabel{(E-Tup-Acc)}
\BinaryInfC{$ \Sem{x \mathsf{.} i}{\Prog,\Env} \Rightarrow{} \tuple{v_i, \Env} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{x}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{[} v_n\mathsf{,} \dots\mathsf{,} v_m \mathsf{]}, \Env} $}
\AxiomC{$ \Sem{y}{\Prog,\Env} \Rightarrow{} \tuple{i, \Env} $}
\AxiomC{$ i \in n \mathsf{..} m$}
\RightLabel{(E-Arr-Ind)}
\TrinaryInfC{$ \Sem{x \mathsf{[} y \mathsf{]}}{\Prog,\Env} \Rightarrow{} \tuple{v_i, \Env} $}
\end{prooftree}
\]</p>
<h3 id="if-then-else-expressions-1"><a class="header" href="#if-then-else-expressions-1">If-then-else expressions</a></h3>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{x_1}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{true}, \Env} $}
\AxiomC{$ \Sem{E_1}{\Prog,\Env} \Rightarrow{} \tuple{v, \Env'} $}
\RightLabel{(E-If)}
\BinaryInfC{$ \Sem{\mathsf{if}<del>x_1</del>\mathsf{then}<del>E_1</del>\mathsf{elseif}<del>x_2</del>\mathsf{then}~E_2 \dots \mathsf{else}<del>E_n</del>\mathsf{endif}}{\Prog,\Env} \Rightarrow{} \tuple{v, \Env'} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{x_1}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{false}, \Env} $}
\AxiomC{$ \Sem{\mathsf{if}<del>x_2</del>\mathsf{then}~E_2 \dots \mathsf{else}<del>E_n</del>\mathsf{endif}}{\Prog,\Env} \Rightarrow{} \tuple{v, \Env'} $}
\RightLabel{(E-ElseIf)}
\BinaryInfC{$ \Sem{\mathsf{if}<del>x_1</del>\mathsf{then}<del>E_1</del>\mathsf{elseif}<del>x_2</del>\mathsf{then}~E_2 \dots \mathsf{else}<del>E_n</del>\mathsf{endif}}{\Prog,\Env} \Rightarrow{} \tuple{v, \Env'} $}
\end{prooftree}
\]</p>
<p>\[
\begin{prooftree}
\AxiomC{$ \Sem{x}{\Prog,\Env} \Rightarrow{} \tuple{\mathsf{false}, \Env} $}
\AxiomC{$ \Sem{E_2}{\Prog,\Env} \Rightarrow{} \tuple{v, \Env'} $}
\RightLabel{(E-Else)}
\BinaryInfC{$ \Sem{\mathsf{if}<del>x</del>\mathsf{then}<del>E_1</del>\mathsf{else}<del>E_2</del>\mathsf{endif}}{\Prog,\Env} \Rightarrow{} \tuple{v, \Env'} $}
\end{prooftree}
\]</p>
<h3 id="identifiers-and-literals"><a class="header" href="#identifiers-and-literals">Identifiers and Literals</a></h3>
<p>\[
\begin{prooftree}
\AxiomC{$ x \in \mathit{ident} $}
\AxiomC{$ {T: x~\texttt{↳}~C } \in \Env $}
\RightLabel{(E-Ident)}
\BinaryInfC{$ \Sem{x}{\Prog, \Env} \Rightarrow{} \tuple{x, \Env} $}
\end{prooftree}
\begin{prooftree}
\AxiomC{$ v \in \mathit{literal} $}
\RightLabel{(E-Lit)}
\UnaryInfC{$ \Sem{v}{\Prog, \Env} \Rightarrow{} \tuple{v, \Env} $}
\end{prooftree}
\]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-microzinc-interpreter"><a class="header" href="#the-microzinc-interpreter">The MicroZinc Interpreter</a></h1>
<h2 id="builtin-functions"><a class="header" href="#builtin-functions">Builtin functions</a></h2>
<p>The following functions have been included as builtin functions for</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="minizinc-syntax-changes"><a class="header" href="#minizinc-syntax-changes">MiniZinc Syntax Changes</a></h1>
<p>New syntax includes:</p>
<ul>
<li>Tuples</li>
<li>Records (which are transformed into tuples)</li>
<li><code>case</code> expression with complex pattern matching (possibly compiled into <code>case</code> with simple matching)</li>
<li>Namespacing/module system</li>
</ul>
<p>Syntax still to be discussed:</p>
<ul>
<li>TypeInst variables syntax</li>
<li>Function type syntax</li>
<li>Module syntax</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="error-handling"><a class="header" href="#error-handling">Error handling</a></h1>
<p>Good error reporting should be integral to the compiler.</p>
<p>We need to think about what errors could be encountered and what information is
needed to generate a useful message.</p>
<h2 id="minizinc---microzinc"><a class="header" href="#minizinc---microzinc">MiniZinc &lt;-&gt; MicroZinc</a></h2>
<ul>
<li>Could keep a stack of the transformations, so we always know the origin of any
new constraints</li>
<li>Transformations generate explanations of why they were done, so the logic can
be followed for debugging</li>
</ul>
<h2 id="bytecode"><a class="header" href="#bytecode">Bytecode</a></h2>
<ul>
<li>Could generate bytecode with debugging symbols giving locations for instructions</li>
<li>Interpreter could have a debugging runtime mode enabling full tracing</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/mzn-highlight.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
